name: Metrics
on:
  schedule: [{cron: "0 * * * *"}]
  workflow_dispatch:
  push: {branches: ["master", "main"]}
jobs:
  github-metrics:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    steps:
      - uses: lowlighter/metrics@latest
        with:
          token: ${{ secrets.METRICS_TOKEN }}
          template: classic
          base: header, activity, community, repositories, metadata
          config_display: large
          config_octicon: yes
          config_padding: 0, 10 + 12%
          config_timezone: Europe/Minsk

          plugin_isocalendar: yes
          plugin_isocalendar_duration: full-year

          plugin_languages: yes
          plugin_languages_analysis_timeout: 15
          plugin_languages_analysis_timeout_repositories: 7.5
          plugin_languages_categories: markup, programming
          plugin_languages_colors: "TypeScript:#00ffb9, JavaScript:#00d49a, HTML:#009e76, CSS:#5ec4a8, Rust:#007a5e, MDX:#d4f7ed"
          plugin_languages_limit: 6
          plugin_languages_recent_categories: markup, programming
          plugin_languages_recent_days: 14
          plugin_languages_recent_load: 300
          plugin_languages_sections: most-used
          plugin_languages_threshold: 0%

          extras_css: |
            /* ═══════════════════════════════════════════════════════
               B A U H A U S · G I T H U B   M E T R I C S
               Form follows function · Emerald Grid · 2025
            ════════════════════════════════════════════════════════ */

            /* ── GLOBAL RHYTHM ─────────────────────────────────── */
            * {
              letter-spacing: 0.015em;
              box-sizing: border-box;
            }

            /* ── H1 — IDENTITY BLOCK ────────────────────────────── */
            h1 {
              color: #ffffff !important;
              font-weight: 900 !important;
              font-size: 1.35em !important;
              text-transform: uppercase !important;
              letter-spacing: 0.08em !important;
              margin: 0 !important;
            }

            /* ── H2 / H3 — BAUHAUS SECTION RULE ────────────────── */
            h2, h3 {
              color: #00ffb9 !important;
              text-transform: uppercase !important;
              letter-spacing: 0.2em !important;
              font-weight: 900 !important;
              font-size: 0.82em !important;
              border-left: 4px solid #00ffb9 !important;
              padding: 3px 0 3px 9px !important;
              margin: 0 0 10px 0 !important;
              line-height: 1.5 !important;
              background: linear-gradient(90deg, rgba(0,255,185,0.07) 0%, transparent 60%) !important;
            }

            /* ── HEADER — Bold bottom rule ──────────────────────── */
            header, .header {
              border-bottom: 3px solid #00ffb9 !important;
              padding-bottom: 12px !important;
              margin-bottom: 6px !important;
            }

            /* ── SECTIONS — Mathematical dividers ───────────────── */
            section {
              border-top: 1px solid rgba(0, 255, 185, 0.22) !important;
              padding-top: 14px !important;
              margin-top: 4px !important;
            }

            /* ── AVATAR — Square geometry, no rounding ──────────── */
            img.avatar, img[src*="avatar"], img[width="64"] {
              border-radius: 0 !important;
              border: 2px solid #009e76 !important;
              outline: 1px solid rgba(0, 255, 185, 0.35) !important;
              outline-offset: 2px !important;
            }

            /* ── PROGRESS / LANGUAGE BARS — Pure rectangles ─────── */
            progress, .progress-bar, .bar {
              border-radius: 0 !important;
            }
            .progress, div[class*="progress"] {
              border-radius: 0 !important;
              background: rgba(0, 255, 185, 0.08) !important;
            }

            /* ── METRIC VALUES — Tabular, high-contrast ─────────── */
            strong, b {
              color: #00ffb9 !important;
              font-weight: 900 !important;
              font-variant-numeric: tabular-nums !important;
            }

            /* ── SECONDARY TEXT — Muted grid tone ───────────────── */
            span, p, li, td {
              color: #c8ede6 !important;
            }

            /* ── ICONS / OCTICONS ────────────────────────────────── */
            .octicon {
              fill: #5ec4a8 !important;
              vertical-align: middle !important;
            }

            /* ── LINKS ───────────────────────────────────────────── */
            a {
              color: #00d49a !important;
              text-decoration: none !important;
              font-weight: 600 !important;
            }

            /* ── TABLES — Bauhaus grid lines ─────────────────────── */
            table {
              border-collapse: collapse !important;
              width: 100% !important;
            }
            th {
              text-transform: uppercase !important;
              letter-spacing: 0.12em !important;
              font-size: 0.62em !important;
              font-weight: 700 !important;
              color: #5ec4a8 !important;
              border-bottom: 2px solid #009e76 !important;
              padding: 4px 6px !important;
            }
            td {
              border: none !important;
              border-bottom: 1px solid rgba(0, 255, 185, 0.09) !important;
              padding: 3px 6px !important;
              vertical-align: middle !important;
            }
            tr:last-child td {
              border-bottom: none !important;
            }

            /* ── CALENDAR — Green spectrum ───────────────────────── */
            :root {
              --color-calendar-graph-day-L1-bg:     #d4f7ed;
              --color-calendar-graph-day-L2-bg:     #5ec4a8;
              --color-calendar-graph-day-L3-bg:     #00a87a;
              --color-calendar-graph-day-L4-bg:     #00ffb9;
              --color-calendar-graph-day-L1-border: rgba(0, 255, 185, 0.08);
              --color-calendar-graph-day-L2-border: rgba(0, 255, 185, 0.08);
              --color-calendar-graph-day-L3-border: rgba(0, 255, 185, 0.08);
              --color-calendar-graph-day-L4-border: rgba(0, 255, 185, 0.08);
            }

            path[fill="#9be9a8"] { fill: #d4f7ed !important; }
            path[fill="#40c463"] { fill: #5ec4a8 !important; }
            path[fill="#30a14e"] { fill: #00a87a !important; }
            path[fill="#216e39"] { fill: #00ffb9 !important; }
            rect[fill="#9be9a8"] { fill: #d4f7ed !important; }
            rect[fill="#40c463"] { fill: #5ec4a8 !important; }
            rect[fill="#30a14e"] { fill: #00a87a !important; }
            rect[fill="#216e39"] { fill: #00ffb9 !important; }

            rect.ContributionCalendar-day {
              rx: 0 !important;
              ry: 0 !important;
            }

          extras_js: |
            (function () {
              const svg = document.querySelector("svg");
              if (!svg) return;

              /* ── SVG dimensions ── */
              const vb = svg.viewBox.baseVal;
              const W  = vb.width  || +svg.getAttribute("width")  || 480;
              const H  = vb.height || +svg.getAttribute("height") || 900;

              /* ── Find isocalendar Y band via month labels ── */
              const MONTHS = ["Jan","Feb","Mar","Apr","May","Jun",
                              "Jul","Aug","Sep","Oct","Nov","Dec"];
              const labels = [...svg.querySelectorAll("text")].filter(t =>
                MONTHS.some(m => t.textContent.trim().startsWith(m))
              );
              let calTop = H * 0.52;
              let calBot = H * 0.78;
              if (labels.length >= 2) {
                const ys = labels.map(t => {
                  try { return t.getBBox().y; } catch(_) {
                    return parseFloat(t.getAttribute("y")) || 0;
                  }
                });
                calTop = Math.min(...ys) - 55;
                calBot = Math.max(...ys) + 60;
              }
              const midY  = calTop + (calBot - calTop) / 2;
              const SZ    = 110;

              /* ── Float keyframes ── */
              const style = document.createElementNS("http://www.w3.org/2000/svg","style");
              style.textContent = `
                @keyframes f1 { 0%,100%{transform:translateY(0px)} 50%{transform:translateY(-10px)} }
                @keyframes f2 { 0%,100%{transform:translateY(-6px)} 50%{transform:translateY(7px)} }
                @keyframes f3 { 0%,100%{transform:translateY(3px)} 50%{transform:translateY(-8px)} }
                .gl1 { animation: f1 5.0s ease-in-out infinite; }
                .gl2 { animation: f2 6.4s ease-in-out infinite 1.2s; }
                .gl3 { animation: f3 4.7s ease-in-out infinite 2.5s; }
              `;
              svg.prepend(style);

              /* ── Helper: create floating image group ── */
              function makeImg(url, cls, x, y, size) {
                const g = document.createElementNS("http://www.w3.org/2000/svg","g");
                g.setAttribute("class", cls);
                g.setAttribute("transform", `translate(${x},${y})`);
                const img = document.createElementNS("http://www.w3.org/2000/svg","image");
                img.setAttribute("href", url);
                img.setAttribute("width",  size);
                img.setAttribute("height", size);
                img.setAttribute("style",  "mix-blend-mode:screen;opacity:0.82");
                g.appendChild(img);
                return g;
              }

              /* ── Coordinates ── */
              const x1 = 4;
              const y1 = midY - SZ * 0.65;

              const x2 = W - SZ - 4;
              const y2 = midY - SZ * 0.1;

              const x3 = 14;
              const y3 = midY + SZ * 0.5;

              /* ── Append images ── */
              const base = "https://raw.githubusercontent.com/kotru21/kotru21/main/.github/images";
              svg.appendChild(makeImg(`${base}/img1.png`, "gl1", x1, y1, SZ));
              svg.appendChild(makeImg(`${base}/img2.png`, "gl2", x2, y2, SZ));
              svg.appendChild(makeImg(`${base}/img3.png`, "gl3", x3, y3, SZ));
            })();
